<!-- Electric Midnight Home -->
<div class="container-fluid p-0">

    <!-- Cinematic Hero -->
    <div class="hero-section fade-in">
        <h1 class="hero-title">Experience<br>Cinema</h1>
        <p class="text-white-50 fs-5">Premium bookings for the modern era.</p>
    </div>

    <!-- Floating Search Only -->
    <div class="filter-island-container justify-content-center">
        <div class="glass-panel search-bar-container">
            <div class="search-input-wrapper">
                <i class="bi bi-search search-icon"></i>
                <input type="text" placeholder="Search for movies..." class="search-input" #searchInput
                    (keyup)="searchMovies(searchInput.value)">
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status"></div>
    </div>

    <!-- Grid Header with Filter Button -->
    <div class="container d-flex justify-content-between align-items-center mb-4 px-4 mt-5" *ngIf="!loading">
        <h2 class="text-white fw-bold m-0"><span class="text-primary">Now</span> Showing</h2>

        <button class="btn btn-outline-light rounded-pill px-3 py-2 d-flex align-items-center gap-2"
            data-bs-toggle="offcanvas" data-bs-target="#mobileFilters">
            <i class="bi bi-sliders2"></i>
            <span>Filters</span>
            <span class="badge bg-primary rounded-pill ms-1" *ngIf="selectedGenres.size + selectedLanguages.size > 0">
                {{ selectedGenres.size + selectedLanguages.size }}
            </span>
        </button>
    </div>

    <!-- Immersive Grid -->
    <div class="movie-grid pb-5" *ngIf="!loading">
        <div class="fade-in-up" *ngFor="let movie of movies; let i = index" [style.animation-delay]="i * 0.02 + 's'">

            <!-- The Card -->
            <div class="cinematic-card" [routerLink]="['/movie', movie.id]">
                <img [src]="movie.imageUrl" class="poster-img" loading="lazy" alt="{{ movie.title }}">

                <!-- Overlays -->
                <div class="card-overlay-gradient"></div>

                <!-- Rating Badge -->
                <div class="rating-badge">
                    <i class="bi bi-star-fill me-1"></i> {{ movie.averageRating || 'N/A' }}
                </div>

                <!-- Watchlist Fab -->
                <button class="watchlist-btn" [class.active]="isInWatchlist(movie.id)"
                    (click)="toggleWatchlist($event, movie)">
                    <i class="bi" [class.bi-heart-fill]="isInWatchlist(movie.id)"
                        [class.bi-heart]="!isInWatchlist(movie.id)"></i>
                </button>

                <!-- Content -->
                <div class="card-content">
                    <h5 class="movie-title text-truncate">{{ movie.title }}</h5>
                    <div class="movie-meta">
                        <!-- Show ONLY first Language & Genre to keep layout clean -->
                        <span>{{ movie.language?.split(',')[0] }}</span>
                        <span>•</span>
                        <span class="text-truncate" style="max-width: 80px;">{{ movie.genre?.split(',')[0] }}</span>
                        <span class="ms-auto border border-secondary px-1 rounded small">{{ movie.censorRating }}</span>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && movies.length === 0" class="text-center py-5 text-muted">
        <h3>No movies found</h3>
        <button class="btn btn-outline-light mt-3 rounded-pill px-4"
            (click)="selectedGenres.clear();selectedLanguages.clear();applyFilter()">Clear Filters</button>
    </div>

    <!-- Mobile Offcanvas Filters (Right Side Bar) -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="mobileFilters">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title text-white">Refine Selection</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">

            <!-- Genres -->
            <div class="mb-4">
                <label class="text-white-50 small fw-bold text-uppercase mb-3 d-block">Genres</label>
                <div class="d-flex flex-wrap gap-2">
                    <span *ngFor="let g of genres" class="sidebar-badge" [class.selected]="isGenreSelected(g.name)"
                        (click)="toggleGenre(g.name)">
                        {{ g.name }}
                    </span>
                </div>
            </div>

            <!-- Languages -->
            <div class="mb-4">
                <label class="text-white-50 small fw-bold text-uppercase mb-3 d-block">Languages</label>
                <div class="d-flex flex-wrap gap-2">
                    <span *ngFor="let l of languages" class="sidebar-badge"
                        [class.selected]="isLanguageSelected(l.name)" (click)="toggleLanguage(l.name)">
                        {{ l.name }}
                    </span>
                </div>
            </div>

            <!-- Rating -->
            <div class="mb-4">
                <label class="text-white-50 small fw-bold text-uppercase mb-3 d-block">Min Rating</label>
                <select class="form-select bg-dark text-white border-secondary rounded-3 py-2"
                    [(ngModel)]="filterRating">
                    <option [ngValue]="null">Any Rating</option>
                    <option [ngValue]="4">⭐⭐⭐⭐ 4+ Excellent</option>
                    <option [ngValue]="3">⭐⭐⭐ 3+ Good</option>
                    <option [ngValue]="2">⭐⭐ 2+ Average</option>
                </select>
            </div>

            <!-- Action Buttons -->
            <div class="d-grid gap-2 mt-5">
                <button class="btn btn-primary rounded-pill py-3 fw-bold shadow-lg" data-bs-dismiss="offcanvas"
                    (click)="applyFilter()">
                    Apply Filters
                </button>
                <button class="btn btn-outline-secondary rounded-pill py-2"
                    (click)="selectedGenres.clear();selectedLanguages.clear();selectedCensorRatings.clear();filterRating=null;applyFilter()">
                    Clear All
                </button>
            </div>

        </div>
    </div>

</div>