<div class="container mt-5" *ngIf="movie">
    <div class="row">
        <!-- Poster Column -->
        <div class="col-md-4 mb-4">
            <img [src]="movie.imageUrl" class="img-fluid rounded shadow-lg poster-large" alt="{{ movie.title }}">
        </div>

        <!-- Details Column -->
        <div class="col-md-8">
            <a routerLink="/home" class="btn btn-link text-secondary ps-0 mb-2 text-decoration-none">
                <i class="bi bi-arrow-left"></i> Back to Movies
            </a>
            <h1 class="display-4 fw-bold text-white mb-2">{{ movie.title }}</h1>

            <div class="mb-4">
                <span class="badge bg-primary me-2">{{ movie.genre }}</span>
                <span class="badge bg-secondary me-2">{{ movie.language }}</span>
                <span class="badge bg-warning text-dark me-2">{{ movie.censorRating }}</span>
                <span class="badge bg-success me-2">
                    <i class="bi bi-star-fill"></i> {{ movie.averageRating || 'N/A' }}
                </span>
                <span class="text-muted"><i class="bi bi-clock"></i> {{ movie.durationMinutes }} mins</span>
            </div>

            <p class="lead text-light description">{{ movie.description }}</p>

            <h4 class="text-white mt-5 mb-3">Release Date</h4>
            <p class="text-muted">{{ movie.releaseDate | date:'longDate' }}</p>

            <!-- Shows Section (STRICT MODE: Button only) -->
            <div class="mt-5 mb-3 border-bottom pb-2 border-secondary">
                <button [routerLink]="['/movie', movie.id, 'shows']"
                    class="btn btn-danger btn-lg w-100 py-3 fw-bold shadow">
                    Book My Show <i class="bi bi-ticket-perforated ms-2"></i>
                </button>
            </div>

            <!-- Reviews Section -->
            <div
                class="d-flex align-items-center justify-content-between mt-5 mb-4 border-bottom border-secondary pb-2">
                <h3 class="text-white m-0">Reviews</h3>
                <span class="badge bg-secondary">{{ reviews.length }} Reviews</span>
            </div>

            <div *ngIf="reviews.length === 0"
                class="text-center py-5 text-muted bg-dark-card rounded border border-secondary">
                <i class="bi bi-chat-square-text fs-1 mb-3 d-block"></i>
                No reviews yet. Be the first to share your thoughts!
            </div>

            <div class="row g-4 mb-5">
                <div class="col-md-6" *ngFor="let review of reviews">
                    <div class="card review-card h-100 p-3">
                        <div class="d-flex align-items-start">
                            <div class="avatar-circle me-3 flex-shrink-0">
                                {{ (review.userName || 'U').charAt(0) }}
                            </div>
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <h6 class="text-white mb-0">{{ review.userName || 'Anonymous' }}</h6>
                                    <div class="star-rating">
                                        <i class="bi bi-star-fill"></i>
                                        <span class="text-white fw-bold">{{ review.rating }}</span><span
                                            class="text-muted small">/5</span>
                                    </div>
                                </div>
                                <p class="text-light description mb-0" style="font-size: 0.95rem; line-height: 1.5;">{{
                                    review.comment }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <!-- Add Review Form -->
            <div class="review-form-card p-4 mt-4" *ngIf="authService.isLoggedIn()">
                <h4 class="text-white mb-4"><i class="bi bi-pencil-square me-2"></i>Write a Review</h4>
                <form [formGroup]="reviewForm" (ngSubmit)="submitReview()">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <label class="form-label text-muted small text-uppercase fw-bold d-block">Rating</label>
                            <div class="star-rating-input mb-1">
                                <i *ngFor="let r of [1,2,3,4,5]" class="bi fs-3 pointer me-1"
                                    [ngClass]="r <= reviewForm.get('rating')?.value ? 'bi-star-fill text-warning' : 'bi-star text-secondary'"
                                    (click)="reviewForm.patchValue({rating: r})"></i>
                            </div>
                            <small class="text-white-50">
                                {{ reviewForm.get('rating')?.value }} Stars - {{ reviewForm.get('rating')?.value >= 5 ?
                                'Excellent' : (reviewForm.get('rating')?.value >= 4 ? 'Good' :
                                (reviewForm.get('rating')?.value >= 3 ? 'Average' : 'Poor')) }}
                            </small>
                        </div>
                        <div class="col-md-9 mb-3">
                            <label class="form-label text-muted small text-uppercase fw-bold">Your Review</label>
                            <textarea class="form-control bg-dark text-white border-secondary" rows="3"
                                placeholder="What did you think of the movie?" formControlName="comment"></textarea>
                        </div>
                    </div>
                    <div class="text-end">
                        <button type="submit" class="btn btn-primary px-4" [disabled]="reviewForm.invalid">
                            Post Review <i class="bi bi-send ms-2"></i>
                        </button>
                    </div>
                </form>
            </div>
            <div *ngIf="!authService.isLoggedIn()" class="alert alert-info mt-4">
                Please <a routerLink="/login">login</a> to write a review.
            </div>
        </div>
    </div>
</div>

<div *ngIf="loading" class="text-center mt-5">
    <div class="spinner-border text-primary" role="status"></div>
</div>

<div *ngIf="error" class="alert alert-danger mt-5">{{ error }}</div>